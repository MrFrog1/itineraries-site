import json
from django.core.management.base import BaseCommand
from region.models import Region
from hotels.models import Hotel
from itineraries.models import AgentItinerary
from django.contrib.auth.models import User

class Command(BaseCommand):
    help = 'Populate database with data from JSON file'

    def add_arguments(self, parser):
        parser.add_argument('json_file', type=str, help='Path to the JSON file')

    def handle(self, *args, **options):
        json_file = options['json_file']
        with open(json_file) as f:
            data = json.load(f)

        for region_data in data['regions']:
            region = Region(**region_data)
            region.save()

        for hotel_data in data['hotels']:
            region_id = hotel_data.pop('region_id')
            region = Region.objects.get(id=region_id)
            hotel = Hotel(region=region, **hotel_data)
            hotel.save()

        for itinerary_data in data['itineraries']:
            region_id = itinerary_data.pop('region_id')
            agent_id = itinerary_data.pop('agent_id')
            region = Region.objects.get(id=region_id)
            agent = User.objects.get(id=agent_id)
            itinerary = AgentItinerary(region=region, agent=agent, **itinerary_data)
            itinerary.save()

        self.stdout.write(self.style.SUCCESS('Database populated successfully.'))